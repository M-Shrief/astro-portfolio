---
import { getCollection } from "astro:content";
// Layouts
import Layout from "../../../layouts/MainLayout.astro";
// Components
import BlogCard from "../../../components/blogCard.astro";
// Utils
import {getClassificationsList} from '../../../utils/blog'

const { category } = Astro.params;

export async function getStaticPaths() {
  const categories = await getClassificationsList("categories");

  return categories.map((category) => {
    return {
      params: { category },
    };
  });
}

const posts = (await getCollection("blog", ({data}) => {
   if (import.meta.env.PROD) {
    if (data.isDraft !== true && data.categories.includes(category)) return true;
   } else {
    if (data.categories.includes(category)) return true;
   }
})).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf() 
);
---


<Layout title="M. Shrief :: Blog" description="Blogs about Web development in the Backend and Frontend.">
    <main>
      <section >
        <h1>Blogs for #{category}</h2>
          

        <ul >
          {
            posts.map((post) => (
            <BlogCard slug={post.slug} title={post.data.title} description={post.data.description}
             pubDate={post.data.pubDate} tags={post.data.tags} categories={post.data.categories} />
            ))
          }
        </ul>
      </section>
    </main>
</Layout>
  
<style lang="scss">
@import "../../../assets/mixins.scss";
main {
    width: 80%;
    margin: 1rem auto;
    @include mQ($breakpoint-sm) {
    width: 95%;
    h1 {
        font-size: 1.4rem;
    }
    }
}
ul {
    .blog {
    position: relative;
    list-style: none;
    padding: 0.5rem 1rem;
    margin: 1rem auto;
    border-radius: 1rem;
    background-color: var(--surface1);
    @include mQ($breakpoint-sm) {
        padding: 0.2rem 0.5rem;
        margin: 0.5rem auto;
    }
    a {
        @include blog-link
    }
    p {
        text-decoration: none;
        color: var(--text2);
        padding-bottom: 0.2rem;
        &:hover {
        text-decoration: none;
        }
        @include mQ($breakpoint-sm) {
        font-size:0.8rem;
        }
    }
    span {
        color: var(--text1);
        position: absolute;
        bottom: 0.5rem;
        right: 1rem;
        @include mQ($breakpoint-sm) {
        bottom: 0.2rem;
        right: 0.5rem;
        font-size:0.6rem;
        }
    }
    }
}
</style>

